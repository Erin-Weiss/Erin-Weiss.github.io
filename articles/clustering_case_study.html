<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Erin Weiss">

<title>Crime Pattern Segmentation Across U.S. States Using Clustering</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="clustering_case_study_files/libs/clipboard/clipboard.min.js"></script>
<script src="clustering_case_study_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="clustering_case_study_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="clustering_case_study_files/libs/quarto-html/popper.min.js"></script>
<script src="clustering_case_study_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="clustering_case_study_files/libs/quarto-html/anchor.min.js"></script>
<link href="clustering_case_study_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="clustering_case_study_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="clustering_case_study_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="clustering_case_study_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="clustering_case_study_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="clustering_case_study_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="clustering_case_study_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">2</span> Setup</a>
  <ul class="collapse">
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries"><span class="header-section-number">2.1</span> Load Libraries</a></li>
  <li><a href="#read-and-examine-the-data" id="toc-read-and-examine-the-data" class="nav-link" data-scroll-target="#read-and-examine-the-data"><span class="header-section-number">2.2</span> Read and Examine the Data</a></li>
  </ul></li>
  <li><a href="#k-means-clustering" id="toc-k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering"><span class="header-section-number">3</span> K-Means Clustering</a>
  <ul class="collapse">
  <li><a href="#methodology-and-parameter-choices" id="toc-methodology-and-parameter-choices" class="nav-link" data-scroll-target="#methodology-and-parameter-choices"><span class="header-section-number">3.1</span> Methodology and Parameter Choices</a></li>
  <li><a href="#k-2" id="toc-k-2" class="nav-link" data-scroll-target="#k-2"><span class="header-section-number">3.2</span> K = 2</a>
  <ul class="collapse">
  <li><a href="#interpretation-k-2" id="toc-interpretation-k-2" class="nav-link" data-scroll-target="#interpretation-k-2"><span class="header-section-number">3.2.1</span> Interpretation: K = 2</a></li>
  </ul></li>
  <li><a href="#k-3" id="toc-k-3" class="nav-link" data-scroll-target="#k-3"><span class="header-section-number">3.3</span> K = 3</a>
  <ul class="collapse">
  <li><a href="#interpretation-k-3" id="toc-interpretation-k-3" class="nav-link" data-scroll-target="#interpretation-k-3"><span class="header-section-number">3.3.1</span> Interpretation: K = 3</a></li>
  </ul></li>
  <li><a href="#k-4" id="toc-k-4" class="nav-link" data-scroll-target="#k-4"><span class="header-section-number">3.4</span> K = 4</a>
  <ul class="collapse">
  <li><a href="#interpretation-k-4" id="toc-interpretation-k-4" class="nav-link" data-scroll-target="#interpretation-k-4"><span class="header-section-number">3.4.1</span> Interpretation: K = 4</a></li>
  </ul></li>
  <li><a href="#k-5" id="toc-k-5" class="nav-link" data-scroll-target="#k-5"><span class="header-section-number">3.5</span> K = 5</a>
  <ul class="collapse">
  <li><a href="#interpretation-k-5" id="toc-interpretation-k-5" class="nav-link" data-scroll-target="#interpretation-k-5"><span class="header-section-number">3.5.1</span> Interpretation: K = 5</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#cluster-cardinality" id="toc-cluster-cardinality" class="nav-link" data-scroll-target="#cluster-cardinality"><span class="header-section-number">4</span> Cluster Cardinality</a></li>
  <li><a href="#within-cluster-sum-of-squares-wcss" id="toc-within-cluster-sum-of-squares-wcss" class="nav-link" data-scroll-target="#within-cluster-sum-of-squares-wcss"><span class="header-section-number">5</span> Within-Cluster Sum of Squares (WCSS)</a>
  <ul class="collapse">
  <li><a href="#within-cluster-sum-of-squares-by-k" id="toc-within-cluster-sum-of-squares-by-k" class="nav-link" data-scroll-target="#within-cluster-sum-of-squares-by-k"><span class="header-section-number">5.0.1</span> <strong>Within-Cluster Sum of Squares by K</strong></a></li>
  <li><a href="#elbow-plot" id="toc-elbow-plot" class="nav-link" data-scroll-target="#elbow-plot"><span class="header-section-number">5.1</span> Elbow Plot</a></li>
  <li><a href="#gap-statistic" id="toc-gap-statistic" class="nav-link" data-scroll-target="#gap-statistic"><span class="header-section-number">5.2</span> Gap Statistic</a></li>
  </ul></li>
  <li><a href="#cluster-profiles-mean-crime-rates" id="toc-cluster-profiles-mean-crime-rates" class="nav-link" data-scroll-target="#cluster-profiles-mean-crime-rates"><span class="header-section-number">6</span> Cluster Profiles: Mean Crime Rates</a>
  <ul class="collapse">
  <li><a href="#interpretation-of-cluster-means" id="toc-interpretation-of-cluster-means" class="nav-link" data-scroll-target="#interpretation-of-cluster-means"><span class="header-section-number">6.0.1</span> Interpretation of Cluster Means</a></li>
  </ul></li>
  <li><a href="#choosing-k" id="toc-choosing-k" class="nav-link" data-scroll-target="#choosing-k"><span class="header-section-number">7</span> Choosing K</a></li>
  <li><a href="#hierarchical-clustering" id="toc-hierarchical-clustering" class="nav-link" data-scroll-target="#hierarchical-clustering"><span class="header-section-number">8</span> Hierarchical Clustering</a>
  <ul class="collapse">
  <li><a href="#complete-linkage-on-unscaled-data" id="toc-complete-linkage-on-unscaled-data" class="nav-link" data-scroll-target="#complete-linkage-on-unscaled-data"><span class="header-section-number">8.1</span> Complete Linkage on Unscaled Data</a>
  <ul class="collapse">
  <li><a href="#cutting-the-dendrogram-into-4-clusters" id="toc-cutting-the-dendrogram-into-4-clusters" class="nav-link" data-scroll-target="#cutting-the-dendrogram-into-4-clusters"><span class="header-section-number">8.1.1</span> Cutting the Dendrogram into 4 Clusters</a></li>
  </ul></li>
  <li><a href="#complete-linkage-on-scaled-data" id="toc-complete-linkage-on-scaled-data" class="nav-link" data-scroll-target="#complete-linkage-on-scaled-data"><span class="header-section-number">8.2</span> Complete Linkage on Scaled Data</a>
  <ul class="collapse">
  <li><a href="#effect-of-scaling" id="toc-effect-of-scaling" class="nav-link" data-scroll-target="#effect-of-scaling"><span class="header-section-number">8.2.1</span> Effect of Scaling</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#comparison-of-methods" id="toc-comparison-of-methods" class="nav-link" data-scroll-target="#comparison-of-methods"><span class="header-section-number">9</span> Comparison of Methods</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">10</span> Conclusion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Crime Pattern Segmentation Across U.S. States Using Clustering</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Erin Weiss </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>This case study analyzes the <strong>USArrests</strong> dataset and explores crime-rate patterns across all 50 U.S. states using both <strong>K-means clustering</strong> and <strong>hierarchical clustering</strong>.</p>
<p>My goals are to:</p>
<ul>
<li>Identify natural groupings among states based on violent crime data</li>
<li>Understand how <strong>Murder</strong>, <strong>Assault</strong>, <strong>UrbanPop</strong>, and <strong>Rape</strong> relate</li>
<li>Determine an appropriate number of clusters for K-means</li>
<li>Compare hierarchical clustering with and without scaling</li>
</ul>
<p>More broadly, this project illustrates how unsupervised learning can uncover hidden structure in multivariate datasets, a skill applicable across many domains beyond criminal justice.</p>
</section>
<section id="setup" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Setup</h1>
<section id="load-libraries" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="load-libraries"><span class="header-section-number">2.1</span> Load Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="read-and-examine-the-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="read-and-examine-the-data"><span class="header-section-number">2.2</span> Read and Examine the Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Arrests <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"USArrests.csv"</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Arrests)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Murder"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Assault"],"name":[2],"type":["int"],"align":["right"]},{"label":["UrbanPop"],"name":[3],"type":["int"],"align":["right"]},{"label":["Rape"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"13.2","2":"236","3":"58","4":"21.2","_rn_":"Alabama"},{"1":"10.0","2":"263","3":"48","4":"44.5","_rn_":"Alaska"},{"1":"8.1","2":"294","3":"80","4":"31.0","_rn_":"Arizona"},{"1":"8.8","2":"190","3":"50","4":"19.5","_rn_":"Arkansas"},{"1":"9.0","2":"276","3":"91","4":"40.6","_rn_":"California"},{"1":"7.9","2":"204","3":"78","4":"38.7","_rn_":"Colorado"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Arrests)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Murder          Assault         UrbanPop          Rape      
 Min.   : 0.800   Min.   : 45.0   Min.   :32.00   Min.   : 7.30  
 1st Qu.: 4.075   1st Qu.:109.0   1st Qu.:54.50   1st Qu.:15.07  
 Median : 7.250   Median :159.0   Median :66.00   Median :20.10  
 Mean   : 7.788   Mean   :170.8   Mean   :65.54   Mean   :21.23  
 3rd Qu.:11.250   3rd Qu.:249.0   3rd Qu.:77.75   3rd Qu.:26.18  
 Max.   :17.400   Max.   :337.0   Max.   :91.00   Max.   :46.00  </code></pre>
</div>
</div>
<p>The <strong>USArrests</strong> dataset contains four variables for each of the 50 states:</p>
<ul>
<li><strong>Murder</strong>: Murder arrests per 100,000</li>
<li><strong>Assault</strong>: Assault arrests per 100,000</li>
<li><strong>UrbanPop</strong>: Percentage of the population living in urban areas</li>
<li><strong>Rape</strong>: Rape arrests per 100,000</li>
</ul>
</section>
</section>
<section id="k-means-clustering" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> K-Means Clustering</h1>
<p>In this section, I use the <code>kmeans()</code> function to perform K-means clustering on the <strong>scaled</strong> USArrests data with <strong>k = 2, 3, 4, and 5</strong>. I then interpret and compare the results for each k and select a preferred number of clusters.</p>
<section id="methodology-and-parameter-choices" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="methodology-and-parameter-choices"><span class="header-section-number">3.1</span> Methodology and Parameter Choices</h2>
<p>To ensure comparability across variables with different scales, I create a standardized version of the data.</p>
<p>After I scale the arrest data each variable has mean 0 and standard deviation 1. This ensures that variables with larger variance do not distort the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>scaledArrests <span class="ot">&lt;-</span> <span class="fu">scale</span>(Arrests)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)  <span class="co"># for reproducibility</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In all K-means runs, I use:</p>
<ul>
<li><code>centers = k</code> to specify the number of clusters</li>
<li><code>nstart = 20</code> to run the algorithm from 20 random initial configurations</li>
</ul>
<p>Using a larger value of <code>nstart</code> helps avoid local optima and is recommended in practice.</p>
</section>
<section id="k-2" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="k-2"><span class="header-section-number">3.2</span> K = 2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>km.out2 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaledArrests, <span class="at">centers =</span> <span class="dv">2</span>, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(scaledArrests, <span class="at">col =</span> km.out2<span class="sc">$</span>cluster <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"K-Means Clustering with K = 2"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(km.out2<span class="sc">$</span>centers, <span class="at">pch =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(scaledArrests, <span class="at">labels =</span> <span class="fu">rownames</span>(scaledArrests),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>), </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">title =</span> <span class="st">"Cluster"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="clustering_case_study_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Cluster counts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(km.out2<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2 
20 30 </code></pre>
</div>
</div>
<section id="interpretation-k-2" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="interpretation-k-2"><span class="header-section-number">3.2.1</span> Interpretation: K = 2</h3>
<p>For <strong>k = 2</strong>, the data are divided into two clusters of 20 and 30 states. On the scatterplot:</p>
<ul>
<li>The points in <strong>Cluster 2</strong> are more closely spaced, which suggests that these states share more similar values for the four crime variables.</li>
<li>The points in <strong>Cluster 1</strong> are more spread out, indicating greater variability within that cluster.</li>
</ul>
<p>The centroids (plotted as squares) show the average position of each cluster. Points that are farther from the centroid differ more from the typical patterns within their cluster. The two clusters are visually distinct, indicating a reasonable separation between higher-crime and lower-crime states, although this is a very coarse segmentation.</p>
</section>
</section>
<section id="k-3" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="k-3"><span class="header-section-number">3.3</span> K = 3</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>km.out3 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaledArrests, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(scaledArrests, <span class="at">col =</span> km.out3<span class="sc">$</span>cluster <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"K-Means Clustering with K = 3"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(km.out3<span class="sc">$</span>centers, <span class="at">pch =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(scaledArrests, <span class="at">labels =</span> <span class="fu">rownames</span>(scaledArrests),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>), </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>), <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">title =</span> <span class="st">"Cluster"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="clustering_case_study_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(km.out3<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2  3 
17 13 20 </code></pre>
</div>
</div>
<section id="interpretation-k-3" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="interpretation-k-3"><span class="header-section-number">3.3.1</span> Interpretation: K = 3</h3>
<p>For <strong>k = 3</strong>, the cluster with the largest membership (Cluster 3) appears at the upper-right region of the plot, representing states with generally higher crime rates. This cluster is more dispersed, indicating greater variability in crime patterns among those states.</p>
<p>The other two clusters are smaller and closer together. Their centroids are relatively near one another, suggesting that these two clusters share more similar crime-level characteristics and differ from the high-crime cluster. However, some overlap between the two smaller clusters is visible, potentially driven by outliers that pull centroids closer together.</p>
</section>
</section>
<section id="k-4" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="k-4"><span class="header-section-number">3.4</span> K = 4</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>km.out4 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaledArrests, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(scaledArrests, <span class="at">col =</span> km.out4<span class="sc">$</span>cluster <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"K-Means Clustering with K = 4"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(km.out4<span class="sc">$</span>centers, <span class="at">pch =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(scaledArrests, <span class="at">labels =</span> <span class="fu">rownames</span>(scaledArrests),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>), </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">title =</span> <span class="st">"Cluster"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="clustering_case_study_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(km.out4<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2  3  4 
13 13  8 16 </code></pre>
</div>
</div>
<section id="interpretation-k-4" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="interpretation-k-4"><span class="header-section-number">3.4.1</span> Interpretation: K = 4</h3>
<p>For <strong>k = 4</strong>, the upper-right portion of the plot (where states have higher crime rates) splits into two distinct clusters (Clusters 2 and 3). Their centroids are close, suggesting related but meaningfully distinct subgroups of higher-crime states.</p>
<p>The bottom-left region, corresponding to lower crime rates, also splits into two clusters (Clusters 1 and 4). These two clusters are closer to each other than to the high-crime clusters, reflecting their shared lower crime patterns.</p>
<p>There is still visible separation between high- and low-crime regions of the plot, but some cluster overlap appears, partly due to outliers. For example, certain states in the green and blue clusters (top-right) appear to overlap with cyan or red states, indicating that some observations lie between group centers.</p>
</section>
</section>
<section id="k-5" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="k-5"><span class="header-section-number">3.5</span> K = 5</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>km.out5 <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaledArrests, <span class="at">centers =</span> <span class="dv">5</span>, <span class="at">nstart =</span> <span class="dv">20</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(scaledArrests, <span class="at">col =</span> km.out5<span class="sc">$</span>cluster <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"K-Means Clustering with K = 5"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(km.out5<span class="sc">$</span>centers, <span class="at">pch =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(scaledArrests, <span class="at">labels =</span> <span class="fu">rownames</span>(scaledArrests),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">1</span>, <span class="at">cex =</span> <span class="fl">0.4</span>, <span class="at">col =</span> <span class="st">"darkgray"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>), </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>), <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">title =</span> <span class="st">"Cluster"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="clustering_case_study_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(km.out5<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2  3  4  5 
 7 12 10 11 10 </code></pre>
</div>
</div>
<section id="interpretation-k-5" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="interpretation-k-5"><span class="header-section-number">3.5.1</span> Interpretation: K = 5</h3>
<p>For <strong>k = 5</strong>, the top-right region (higher-crime states) remains split into two clusters, similar to k = 4. However, the bottom-left region (lower-crime states) is now split into three clusters.</p>
<p>The three lower-crime clusters have centroids that are close together and substantial overlap in their points, suggesting that the additional clusters do not meaningfully separate different crime profiles. For example, Clusters 4 and 5 appear very similar, with heavily overlapping observations. This indicates that <strong>k = 5 may be overfitting</strong>, creating clusters that do not represent distinct, interpretable groupings.</p>
</section>
</section>
</section>
<section id="cluster-cardinality" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Cluster Cardinality</h1>
<p>Cluster cardinality is the number of states in each cluster. It can be helpful to examine cardinality to determine if the data are well distributed across the clusters.</p>
<p>From the K-means results:</p>
<ul>
<li><strong>K = 2</strong>
<ul>
<li>Cluster 1: 20 states</li>
<li>Cluster 2: 30 states</li>
</ul></li>
<li><strong>K = 3</strong>
<ul>
<li>Cluster 1: 17 states</li>
<li>Cluster 2: 13 states</li>
<li>Cluster 3: 20 states</li>
</ul></li>
<li><strong>K = 4</strong>
<ul>
<li>Cluster 1: 13 states</li>
<li>Cluster 2: 13 states</li>
<li>Cluster 3: 8 states</li>
<li>Cluster 4: 16 states</li>
</ul></li>
<li><strong>K = 5</strong>
<ul>
<li>Cluster 1: 7 states</li>
<li>Cluster 2: 12 states</li>
<li>Cluster 3: 10 states</li>
<li>Cluster 4: 11 states</li>
<li>Cluster 5: 10 states</li>
</ul></li>
</ul>
<p>These results confirm that each clustering accounts for all 50 states (no states are dropped or duplicated). Some configurations, such as <strong>k = 3 and k = 4</strong>, show relatively balanced cluster sizes, while <strong>k = 5</strong> produces a smaller cluster (7 states), which may be more sensitive to outliers.</p>
</section>
<section id="within-cluster-sum-of-squares-wcss" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Within-Cluster Sum of Squares (WCSS)</h1>
<p>Within-cluster variation is a metric that gauges the extent to which states within a cluster differ from each other. A good clustering seeks to minimize within-cluster variation. This is often measured using the <strong>within-cluster sum of squares (WCSS)</strong>.</p>
<p>For each K-means solution, I examined the total WCSS and individual cluster WCSS values. In general:</p>
<section id="within-cluster-sum-of-squares-by-k" class="level3" data-number="5.0.1">
<h3 data-number="5.0.1" class="anchored" data-anchor-id="within-cluster-sum-of-squares-by-k"><span class="header-section-number">5.0.1</span> <strong>Within-Cluster Sum of Squares by K</strong></h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>K</th>
<th>Cluster 1</th>
<th>Cluster 2</th>
<th>Cluster 3</th>
<th>Cluster 4</th>
<th>Cluster 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>56.11</td>
<td>46.75</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
<tr class="even">
<td>3</td>
<td>19.62</td>
<td>11.95</td>
<td>46.75</td>
<td>—</td>
<td>—</td>
</tr>
<tr class="odd">
<td>4</td>
<td>8.32</td>
<td>19.92</td>
<td>16.21</td>
<td>11.95</td>
<td>—</td>
</tr>
<tr class="even">
<td>5</td>
<td>7.44</td>
<td>6.13</td>
<td>9.33</td>
<td>7.79</td>
<td>18.26</td>
</tr>
</tbody>
</table>
<p>For <strong>k = 2</strong>, one cluster has higher WCSS than the other, indicating more spread in that cluster.</p>
<p>For <strong>k = 3</strong> and <strong>k = 4</strong>, WCSS decreases as k increases, as expected, but the marginal gain diminishes.</p>
<p>For <strong>k = 5</strong>, one cluster has a much higher WCSS than the others, indicating that the cluster is quite dispersed.</p>
<p>To summarize the overall trade-off between number of clusters and WCSS, I use an elbow plot.</p>
</section>
<section id="elbow-plot" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="elbow-plot"><span class="header-section-number">5.1</span> Elbow Plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="fu">c</span>(km.out2<span class="sc">$</span>tot.withinss,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>         km.out3<span class="sc">$</span>tot.withinss,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>         km.out4<span class="sc">$</span>tot.withinss,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         km.out5<span class="sc">$</span>tot.withinss)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>wss_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">clusters =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">wss =</span> wss)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wss_df, <span class="fu">aes</span>(<span class="at">x =</span> clusters, <span class="at">y =</span> wss)) <span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Elbow Plot of Total Within-Cluster Sum of Squares"</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Clusters (k)"</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Total WCSS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="clustering_case_study_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The elbow plot shows a noticeable bend at <strong>k = 4</strong>, suggesting that increasing the number of clusters beyond 4 leads to diminishing returns in reducing within-cluster variation.</p>
</section>
<section id="gap-statistic" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="gap-statistic"><span class="header-section-number">5.2</span> Gap Statistic</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>gap_stat <span class="ot">&lt;-</span> <span class="fu">clusGap</span>(scaledArrests,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">FUN =</span> kmeans,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nstart =</span> <span class="dv">20</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">K.max =</span> <span class="dv">10</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">B =</span> <span class="dv">50</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_gap_stat</span>(gap_stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="clustering_case_study_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The gap statistic supports <strong>k in the range of 3–4</strong>, indicating that both 3 and 4 clusters offer reasonable structure, with <strong>k = 4</strong> providing a slightly better balance between fit and complexity.</p>
</section>
</section>
<section id="cluster-profiles-mean-crime-rates" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Cluster Profiles: Mean Crime Rates</h1>
<p>To better understand what differentiates the clusters, I examine the mean values of each variable by cluster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(Arrests, <span class="at">by =</span> <span class="fu">list</span>(<span class="at">cluster =</span> km.out2<span class="sc">$</span>cluster), mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["cluster"],"name":[1],"type":["int"],"align":["right"]},{"label":["Murder"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Assault"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UrbanPop"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Rape"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"12.165","3":"255.2500","4":"68.40000","5":"29.16500"},{"1":"2","2":"4.870","3":"114.4333","4":"63.63333","5":"15.94333"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(Arrests, <span class="at">by =</span> <span class="fu">list</span>(<span class="at">cluster =</span> km.out3<span class="sc">$</span>cluster), mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["cluster"],"name":[1],"type":["int"],"align":["right"]},{"label":["Murder"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Assault"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UrbanPop"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Rape"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"5.841176","3":"141.88235","4":"72.47059","5":"18.82353"},{"1":"2","2":"3.600000","3":"78.53846","4":"52.07692","5":"12.17692"},{"1":"3","2":"12.165000","3":"255.25000","4":"68.40000","5":"29.16500"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(Arrests, <span class="at">by =</span> <span class="fu">list</span>(<span class="at">cluster =</span> km.out4<span class="sc">$</span>cluster), mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["cluster"],"name":[1],"type":["int"],"align":["right"]},{"label":["Murder"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Assault"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UrbanPop"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Rape"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"3.60000","3":"78.53846","4":"52.07692","5":"12.17692"},{"1":"2","2":"10.81538","3":"257.38462","4":"76.00000","5":"33.19231"},{"1":"3","2":"13.93750","3":"243.62500","4":"53.75000","5":"21.41250"},{"1":"4","2":"5.65625","3":"138.87500","4":"73.87500","5":"18.78125"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(Arrests, <span class="at">by =</span> <span class="fu">list</span>(<span class="at">cluster =</span> km.out5<span class="sc">$</span>cluster), mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["cluster"],"name":[1],"type":["int"],"align":["right"]},{"label":["Murder"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Assault"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UrbanPop"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Rape"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"14.671429","3":"251.2857","4":"54.28571","5":"21.68571"},{"1":"2","2":"10.966667","3":"264.0000","4":"76.50000","5":"33.60833"},{"1":"3","2":"2.680000","3":"70.1000","4":"51.00000","5":"10.91000"},{"1":"4","2":"7.072727","3":"140.2727","4":"61.45455","5":"20.13636"},{"1":"5","2":"5.050000","3":"136.7000","4":"79.30000","5":"17.59000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<section id="interpretation-of-cluster-means" class="level3" data-number="6.0.1">
<h3 data-number="6.0.1" class="anchored" data-anchor-id="interpretation-of-cluster-means"><span class="header-section-number">6.0.1</span> Interpretation of Cluster Means</h3>
<p>From the original tables:</p>
<ul>
<li>For <strong>k = 2</strong>, Cluster 1 has substantially higher averages for Murder, Assault, and Rape than Cluster 2, while UrbanPop differs less dramatically. This suggests that <strong>overall violent crime is not tightly coupled to urbanization level</strong> across all states.</li>
<li>For <strong>k = 3</strong> and <strong>k = 4</strong>, there is a clear ordering of clusters from lowest to highest crime, with one cluster consistently representing the highest-crime states, and another representing the lowest-crime states.</li>
<li>For <strong>k = 5</strong>, Cluster 2 has the highest crime rates, and Cluster 1 also has elevated crime levels, but once again, the average UrbanPop does not consistently align with higher crime, reinforcing that urbanization percentage is not the primary driver of violent crime rates in this dataset.</li>
</ul>
</section>
</section>
<section id="choosing-k" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Choosing K</h1>
<p>Taking into account:</p>
<ul>
<li>Visual separation of clusters</li>
<li>Cluster cardinality</li>
<li>Within-cluster variation (WCSS)</li>
<li>Elbow plot</li>
<li>Gap statistic</li>
<li>Interpretability of cluster means</li>
</ul>
<p>I choose <strong>k = 4</strong> as the preferred K-means solution. It provides:</p>
<ul>
<li>Clear separation between high- and low-crime states</li>
<li>Reasonably balanced cluster sizes</li>
<li>Meaningful differences in average crime rates across clusters</li>
<li>An elbow in the WCSS curve, indicating a good trade-off between model complexity and fit</li>
</ul>
</section>
<section id="hierarchical-clustering" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Hierarchical Clustering</h1>
<p>Next, I perform hierarchical clustering using <strong>complete linkage</strong> and <strong>Euclidean distance</strong>, both with and without scaling.</p>
<section id="complete-linkage-on-unscaled-data" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="complete-linkage-on-unscaled-data"><span class="header-section-number">8.1</span> Complete Linkage on Unscaled Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>hc.complete <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(Arrests), <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hc.complete,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">cex =</span> <span class="fl">0.5</span>,  <span class="co"># label size</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">ggtheme =</span> <span class="fu">theme_minimal</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="clustering_case_study_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="cutting-the-dendrogram-into-4-clusters" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="cutting-the-dendrogram-into-4-clusters"><span class="header-section-number">8.1.1</span> Cutting the Dendrogram into 4 Clusters</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hc.complete, <span class="at">k =</span> <span class="dv">4</span>,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">cex =</span> <span class="fl">0.5</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">k_colors =</span> <span class="fu">c</span>(<span class="st">"#2E9FDF"</span>, <span class="st">"#00AFBB"</span>, <span class="st">"#E7B800"</span>, <span class="st">"red"</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">color_labels_by_k =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">ggtheme =</span> <span class="fu">theme_minimal</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="clustering_case_study_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Using the unscaled data, the hierarchical clustering groups states into four clusters (as described above). These groupings largely reflect differences in crime levels and, to some extent, regional patterns.</p>
</section>
</section>
<section id="complete-linkage-on-scaled-data" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="complete-linkage-on-scaled-data"><span class="header-section-number">8.2</span> Complete Linkage on Scaled Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>hc.complete2 <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(scaledArrests), <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_dend</span>(hc.complete2, <span class="at">k =</span> <span class="dv">4</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">cex =</span> <span class="fl">0.5</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">k_colors =</span> <span class="fu">c</span>(<span class="st">"#2E9FDF"</span>, <span class="st">"#00AFBB"</span>, <span class="st">"#E7B800"</span>, <span class="st">"red"</span>),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">color_labels_by_k =</span> <span class="cn">TRUE</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">ggtheme =</span> <span class="fu">theme_minimal</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="clustering_case_study_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="effect-of-scaling" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="effect-of-scaling"><span class="header-section-number">8.2.1</span> Effect of Scaling</h3>
<p>Scaling the variables before computing distances has a strong impact on hierarchical clustering:</p>
<ul>
<li>Each variable contributes equally to the distance computation.</li>
<li>Variables with large numeric ranges (such as Assault) no longer dominate the clustering.</li>
<li>Clusters now reflect a more balanced combination of all four variables.</li>
</ul>
<p>In my opinion, the variables <strong>should be scaled</strong> before computing inter-observation dissimilarities in this context, because Murder, Assault, UrbanPop, and Rape are on different scales, and I want each to have a comparable impact on the clustering.</p>
</section>
</section>
</section>
<section id="comparison-of-methods" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Comparison of Methods</h1>
<p>Comparing:</p>
<ul>
<li><strong>K-means clustering</strong> with k = 2–5</li>
<li><strong>Hierarchical clustering</strong> with and without scaling</li>
</ul>
<p>I find that:</p>
<ul>
<li><strong>K-means with k = 4</strong> produces a useful segmentation of states into four groups with distinct crime profiles and balanced cluster sizes.</li>
<li><strong>Hierarchical clustering on scaled data</strong> produces clear dendrogram structure and visually distinct clusters, and is helpful for understanding nested relationships and exploring different numbers of clusters.</li>
<li>Scaling is crucial for both K-means and hierarchical clustering to prevent high-variance variables (such as Assault) from overwhelming other variables in the distance calculations.</li>
</ul>
</section>
<section id="conclusion" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Conclusion</h1>
<p>Through K-means and hierarchical clustering of the USArrests dataset, I uncovered distinct groupings of U.S. states based on violent crime patterns:</p>
<ul>
<li><strong>K-means with k = 4</strong> offers a good balance between interpretability and compactness, segmenting states into low-, medium-, and high-crime groups with clear differences in Murder, Assault, and Rape rates.</li>
<li><strong>UrbanPop</strong> does not consistently track with crime rates, suggesting that simple urbanization percentage is not the main driver of violent crime levels in this dataset.</li>
<li><strong>Hierarchical clustering with scaled data</strong> provides additional insight into how states cluster at different levels of granularity.</li>
</ul>
<p>This analysis demonstrates how clustering methods can be applied to real-world public safety data to reveal underlying patterns and support exploratory policy analysis or further modeling. The techniques demonstrated here are also broadly applicable to many fields, from customer segmentation and risk analysis to healthcare and urban planning, wherever grouped behavior needs to be uncovered.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>